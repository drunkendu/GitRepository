## 数据库

#### SQL通用语法

1. SQL语句可以单行或多行书写。
2. SQL语句可以使用缩进/空格。
3. SQL语句不区分大小写，关键字建议大写。
4. 注释

- 单行注释。`--`或`#`
- 多行注释。`/* */`



#### 数据类型

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B1.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B2.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B3.png)



#### DDL操作

###### DDL数据库操作

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C.png)



###### DDL表操作

1. 查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E6%9F%A5%E8%AF%A2.png)

2. 创建

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E5%88%9B%E5%BB%BA.png)

3. 修改

- 添加

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B9.png)

- 删除字段

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B92.png)

- 修改数据类型

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B94.png)

- 修改表名

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E4%BF%AE%E6%94%B93.png)

- 删除表

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DDL%E8%A1%A8%E6%93%8D%E4%BD%9C-%E5%88%A0%E9%99%A4.png)

#### DML

###### 添加数据

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DML%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE.png)

字符串和日期型数据，应该包含在引号中。



###### 修改数据

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DML%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE.png)



###### 删除数据

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DML%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE.png)



#### DQL

###### 基本语法

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E8%AF%AD%E6%B3%95.png)



###### 基本查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2.png)



###### 条件查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E6%A1%88%E4%BE%8B1.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0.png)



###### 聚合函数

![]()

`null`不参与聚合函数的运算



###### 分组查询

`where`与`having`的区别

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/where%E4%B8%8Ehaving%E7%9A%84%E5%8C%BA%E5%88%AB.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2.png)

也可以使用别名来代替后面的`count(*)`

执行顺序：`where`>聚合函数>`having`



###### 排序查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2.png)

排序方式：

- `ASC`为升序(默认)

- `DESC`为降序

如果为多字段排序，则先排第一个，第一个相同再排第二个。



###### 分页查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E6%A1%88%E4%BE%8B3.png)



综合案例：

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png)





###### 执行顺序

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DQL%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png)



#### DCL

###### 管理用户

![]([images\DCL管理用户.png](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DCL%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7.png))

`localhost`只能在本主机访问，而`%`能在任意主机访问。

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DCL%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E6%A1%88%E4%BE%8B.png)



###### 权限控制

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/DCL%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6.png)



#### 函数

###### 字符串函数

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0.png)

select 函数(参数)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/substring%E6%A1%88%E4%BE%8B.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/lpad%E6%A1%88%E4%BE%8B.png)



###### 数值函数

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0.png)

只要小数位不为`0`，向上取整都会加`1`，例如`1.1`为`2`

`mod`是取余

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E9%AA%8C%E8%AF%81%E7%A0%81%E6%A1%88%E4%BE%8B.png)

函数可以嵌套，`rand()`获得随机数小数，乘以一个值获得有6位整数的小数，然后利用`round`，将小数位数设置为0。之后考虑到可能会出现0.012359之类的小数，乘以一个数却是5位数，所以又采用`lpad`或者`rpad`用0补齐。



###### 日期函数

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%97%A5%E6%9C%9F%E6%A1%88%E4%BE%8B.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%9F%A5%E8%AF%A2%E5%85%A5%E8%81%8C%E5%A4%A9%E6%95%B0.png)



###### 流程函数

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%9F%8E%E5%B8%82%E7%AD%89%E7%BA%A7%E6%A1%88%E4%BE%8B.png)



#### 约束

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E7%BA%A6%E6%9D%9F.png)

一个字段可以添加多个约束。

`auto_increment`是自动增长

`CHECK`用来检查插入该字段的数据是否满足条件

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E7%BA%A6%E6%9D%9F%E6%A1%88%E4%BE%8B.png)



###### 外键约束

拥有外键的表为子表，关联外键的表为父表。

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%AD%90%E8%A1%A8%E5%92%8C%E7%88%B6%E8%A1%A8.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%A4%96%E9%94%AE%E8%AF%AD%E6%B3%95.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE.png)



###### 删除更新

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%E5%88%A0%E9%99%A4%E6%9B%B4%E6%96%B0.png)

如果删除父表的某条数据，`cascade`会删除整个一列，而`set null`只会修改为`null`

`set null`:

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/setnull.png)

`cascade`:

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/cascade.png)



#### 多表查询

###### 一对多

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E4%B8%80%E5%AF%B9%E5%A4%9A.png)

###### 多对多

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%A4%9A%E5%AF%B9%E5%A4%9A.png)



###### 一对一

![]([images\一对一.png](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E4%B8%80%E5%AF%B9%E4%B8%80.png))



`select *from emp,dept`会出现笛卡尔积的情况：

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF.png)

消除笛卡尔积：

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%B6%88%E9%99%A4%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF.png)

找到两个表之间的关联部分。



###### 多表查询分类

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB.png)



#### 内链接

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%86%85%E8%BF%9E%E6%8E%A5%E8%AF%AD%E6%B3%95.png)



![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%86%85%E8%BF%9E%E6%8E%A5%E6%A1%88%E4%BE%8B.png)



#### 外连接

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%A4%96%E8%BF%9E%E6%8E%A5%E8%AF%AD%E6%B3%95.png)



![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%A4%96%E8%BF%9E%E6%8E%A5%E6%A1%88%E4%BE%8B.png)



#### 自连接

![]([images\自链接语法.png](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E8%87%AA%E9%93%BE%E6%8E%A5%E8%AF%AD%E6%B3%95.png))



![]([images\自链接案例.png](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E8%87%AA%E9%93%BE%E6%8E%A5%E6%A1%88%E4%BE%8B.png))

`union`：将两个表去重后合并为一个表。

`union all`：直接合并两个表成为一个表。

联合查询的字段列数和类型必须相同。



#### 子查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%AD%90%E6%9F%A5%E8%AF%A2.png)



###### 标量子查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B.png)



###### 列子查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2.png)



![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E5%88%97%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B.png)



###### 行子查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B.png)

`(salary,managerid)=(a,b)`意思是`salary=a`，并且`managerid=b`。



###### 表子查询

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E8%A1%A8%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B1.png)

![](https://github.com/drunkendu/GitRepository/blob/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/images/%E8%A1%A8%E5%AD%90%E6%9F%A5%E8%AF%A22.png)



#### replace

`repalce`函数：`replace(s1,s2,s3)`，`s1`是原字符串，`s2`是被替换的字符串`s3`是新的字符串。

例如：将`X`替换为`m`

```mysql
SELECT REPLACE("XYZ FGH XYZ", "X", "m");
```



#### greatest

`greatest`函数：在不同的多个列中选出最大的数值。

```mysql
SELECT x, y, z,
  IF(x + y + z > 2 * GREATEST(x, y, z) , 'Yes', 'No') AS triangle
FROM Triangle;
```

